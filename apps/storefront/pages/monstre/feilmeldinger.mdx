import { Meta, ResponsiveIframe, Image } from '@components';
import { MenuPageLayout } from '@layouts';
import { Figma } from 'mdx-embed';
import { Heading, Paragraph, Alert } from '@digdir/design-system-react';

<Meta
  title='Feilmeldinger'
  description='Slik forteller du brukeren at noe har gått galt eller mangler.'
/>

export default ({ children, menu }) => (
  <MenuPageLayout
    content={children}
    data={{
      title: 'Feilmeldinger',
      date: '3. januar 2024',
    }}
  />
);

Det beste er om vi klarer å forhindre at feil oppstår. For å unngå at feil oppstår kan vi i forkant være tydelig på forventninger og krav, gi eksempler på korrekt utfylling, og være fleksible på formattering. Vi må la brukerne kunne ombestemme seg og alltid gi dem en vei ut.

Når det likevel har oppstått et problem som gjør at brukeren ikke kommer videre, skal vi vise en feilmelding som beskriver problemet og forklarer hva brukerne må gjøre.

Vi har ulike typer visninger av feilmeldinger:

- [Detaljerte feilmeldinger](#detaljerte-feilmeldinger) som tilhører et bestemt felt i et skjema
- [Oppsummerende feilmeldinger](#oppsummerende-feilmeldinger) som kan vise en eller flere feilmeldinger

For andre type feil som ikke tilhører et skjemaelement og ikke validerer brukerens inndata, kan du bruke [alert](/docs/felles-alert--docs)-komponenten. For eksempel for systemfeil, eller til myke valideringer. Myke valideringer er valideringsmeldinger som ikke stopper brukeren fra å sende inn eller gå videre til neste steg i prosessen, men som benyttes til å gi brukeren ulike former for informasjon.

## Detaljerte feilmeldinger

Feilmeldinger som tilhører et bestemt felt på siden, skal vi plassere så nært feilen som mulig. I tillegg skal den kobles til feltet med `aria-describedby`.

Feltet skal tydelig vise at noe er feil. Dette gjøres med rød farge, [forklarende tekst](#tekst-i-feilmeldinger) og `aria-invalid`. Teksten som viser hva som er feil og hva brukeren må gjøre, skal komme rett under ledeteksten og eventuelt hjelpeteksten for feltet.

<Image
  src='/img/errormessage-1.png'
  alt='Skjermbilde av skjema med ett spørsmål på en side, der spørsmålet er obligatorisk'
  boxShadow={false}
/>

### Når skal feilmeldinger presenteres for brukeren?

Det finnes flere tidspunkt du kan presentere feilmeldinger for brukerne

- Mens brukeren fyller ut
- Idet fokus forlater feltet
- Når brukeren trykker "Gå videre" eller "Send inn"

Du bør som regel _ikke_ vise feilmeldinger mens brukeren fyller ut feltet. Mange bruker nemlig tastatur til å navigere seg gjennom skjema og vil ikke nødvendigvis starte på toppen og jobbe seg nedover. Det vil da være forstyrrende om det dukker opp feilmeldinger på felter man ikke har jobbet med enda. Om du har feilmeldinger som skal vises idet brukeren forlater feltet er det viktig å sjekke om brukeren faktisk har skrevet noe i feltet før du viser feilmeldingen. Det tryggeste er å vise feilmeldingene når brukeren selv er klar til å gå videre.

Påkrevde felter bør aldri aktivere feilmelding før brukeren prøver å gå til neste side eller forsøker å sende inn skjema. Om de aktiveres når brukeren forlater feltet kan det bli et irritasjonsmoment. Vær heller tydelig på at feltene er obligatoriske. Se hvordan du markerer [obligatoriske og valgfrie skjemafelt](/monstre/obligatoriske-og-valgfrie-felt).

## Oppsummerende feilmeldinger

I noen tilfeller bør vi oppsummere alle feil øverst på siden eller like over "Gå videre" / "Send inn"-knappen. Oppsummeringen kan gjelde for en eller flere feil. Teksten i en oppsummerende feilmelding skal være lik det du ser i den detaljerte feilen (se eksempel under).

<Image
  src='/img/errormessage-2.png'
  alt='Skjermbilde av skjema med ett spørsmål på en side, der spørsmålet er obligatorisk'
  boxShadow={false}
/>

Om oppsummeringen plasseres i toppen av siden eller lengre nede over "Gå videre" / "Send inn"-knappen, slik som i eksempelet over, avhenger av løsningen din. Det viktigste er at oppsummeringen er synlig uten at brukeren må lete etter den.

Pass på at

- oppsummeringen viser alle feilmeldingene som gjelder for siden eller trinnet
- brukerne kan gå direkte til feilene de må rette og at fokuset blir flyttet dit
- lenkene i oppsummeringen stemmer med feilmeldingen de lenker til
- du skriver feilmeldingen slik at den er lett å forstå, at den gir mening for brukerne når de kun leser feilmeldingen i oppsummeringen
- hvis det er flere feil, så lenker du til den første feilen i rekken
- feilene forsvinner fra oppsummeringen etter hvert som brukerne fikser dem

## Deaktivering av submit-knappen

Ikke bruk deaktivert "Gå videre"/"Send inn"-knapp til skjemavalidering. Noen brukere forstår ikke hvorfor knappen er deaktivert, og kan bli forvirret. Brukere med synsnedsettelse kan slite med å finne knappen og tro at skjemaet har tekniske problemer. Vis i stedet oppsummerende feilmeldinger over "Gå videre"/"Send inn"-knappene dersom brukeren forsøker å trykke på knappen med feil i skjemaet.

## Tekst i feilmeldinger

Den viktigste jobben til teksten i en feilmelding er å hjelpe brukerne videre:

- Tenk på målgruppen og skriv vennlig, klart og tydelig. Unngå passivt eller teknisk språk. Meldingen skal være lett å forstå.
- Unngå humor i feilmeldinger. Når folk møter på et problem, vil de heller ha effektive forslag til hvordan de løser det, enn humoristiske «Oops!»
- Vær konkret. Å skrive “Feltet er ikke fyllt ut korrekt”, gir ikke brukeren en forklaring på hva som er feil. Gi så spesifikk informasjon som mulig om hva problemet er og gjenta nøkkelord fra label.
- Noen ganger må vi beskrive hva feilen er før vi beskriver hva brukerne skal gjøre, men det viktigste er å vise løsningen på problemet.
- Tilpass feilmeldingene til ulike situasjoner. Jobben til teksten er å hjelpe brukeren videre.
- Hold feilmeldingen kort, da sparer du brukerne for tid.

Eksempel på forklarende feilmeldinger:<br/>

- “Postnummeret må ha 4 siffer”
- "Fødselsnummeret må ha 11 siffer"
- “Velg minst ett av leveringsalternativene”
- “Kryss av i ruten for å bekrefte at navnet er riktig, før du sender inn skjemaet”

## Kilder

- [Help users to Recover from validation errors, GovUK](https://design-system.service.gov.uk/patterns/validation/)
- [Designing Better Error Messages UX, Smashing Magazine/Vitaly Friedman](https://www.smashingmagazine.com/2022/08/error-messages-ux-design)
- [Formidle feil i skjema, UU-tilsynet](https://www.uutilsynet.no/veiledning/skjema/38#formidle_feil_i_skjema)
- [Use forgiving formatting, NN Group](https://www.nngroup.com/articles/slips/)
- [Error Messages Guidelines, NN Group](https://www.nngroup.com/articles/error-message-guidelines/)
- [How to Report Errors in Forms, NN Group](https://www.nngroup.com/articles/errors-forms-design-guidelines/)
- [Understanding Success Criterion 3.3.1: Error Identification](https://www.w3.org/WAI/WCAG21/Understanding/error-identification.html)
- [Understanding Success Criterion 3.3.3: Error Suggestion](https://www.w3.org/WAI/WCAG21/Understanding/error-suggestion)
- [Skjemavalidering, Aksel](https://aksel.nav.no/god-praksis/artikler/skjemavalidering)
- [Fejlmeddelelser, Fælles designsystem](https://designsystem.dk/komponenter/fejlmeddelelser/)
