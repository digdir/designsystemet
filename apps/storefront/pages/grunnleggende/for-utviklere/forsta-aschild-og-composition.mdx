import { MenuPageLayout } from '@layouts';
import { Meta, CodeSnippet } from '@components';

<Meta
  title='Forstå asChild og Composition'
  description='All informasjonen du trenger for å forstå asChild og Composition.'
/>

export default ({ children }) => (
  <MenuPageLayout
    content={children}
    data={{
      title: 'Forstå asChild og Composition',
      date: '31. januar 2024',
    }}
  />
);

Nokre gangar må du kanskje bytte ut ein komponent med ein anna, for eksempel `Button` skulle vært ein `Link`.
Det er her `asChild` kjem inn i biletet.

<CodeSnippet language='ts'>
  {`
  import { Button, Link } from '@digdir/design-system-react';

  <Button asChild>
    <Link href='https://www.digdir.no'>Lenke til digdir.no</Link>
  </Button>
`}
</CodeSnippet>

I kodesnutten over blir `Button`-komponenten rendra som ein `Link`-komponent. Når dette skal ut i DOMen, så er det kun eit element som blir rendra ut.
Dette skjer ved hjelp av Radix sin `Slot`-komponent. [1]

`Slot` merger sine props ned på den komponenten som ligger som direkte barn. I tilfellet over så vil `Button` sine props bli lagt til på `Link`-komponenten, og
det er ein `a`-tagg som blir rendra ut.
Når du bruker `asChild`, så kan du ikkje ha meir enn eit barn, men du kan ha så mange du vil inne i det barnet.

<CodeSnippet language='ts'>
  {`
  <>
    /* Dette kaster ein error */
    <Button asChild>
      <Icon />
      <Link href='https://www.digdir.no'>Din lenke</Link>
    </Button>

    /* Dette går fint */
    <Button asChild>
      <Link href='https://www.digdir.no'>
        <Icon />
        Din lenke
      </Link>
    </Button>

  </>
`}
</CodeSnippet>

## Kvifor bruke asChild?

Me har tidlegare brukt ein `as` prop for å rendre som andre element, men når du bruker denne, så får du ikkje typesafety eller korrekte typer iht. elementet du har endret til med `as`.
`Slot` fikser dette ved at du legger alle props på barnet av komponenten, og du får dermed typesafety.

<CodeSnippet language='ts'>
  {`
  <Button asChild>
    <Link href='https://www.digdir.no' onClick={() => {}}>
      <Icon />
      Din lenke
    </Link>
  </Button>
`}
</CodeSnippet>

Alt av klassenavn, aria-attributer og andre props som `Button` har, vil bli lagt til på `Link`-komponenten.
Dette betyr at me kan tilby god tilgjengelegheit, samtidig som du kan bruke andre komponentar som du ønsker.

## Event handlers

Dersom ein prop starter med `on` (fks. `onClick`), så er det sett på som ein event handler.
Når `Slot` merger props, vil det lage ein ny funksjon som kallar alle event handlers som er definert på `Button` og `Link`, men funksjonen som ligger på `Link` vil bli kalla først.
Dette betyr at dersom du stopper eit event på din komponent, vil eventet på `Slot`-komponenten ikkje bli kalla.

Dersom ein av event handlerane er avhengig av `event.defaultPrevented`, så må du passe på at rekkefølga er korrekt. [2]

<CodeSnippet language='ts'>
  {`
  <Button
    asChild
    onClick={(event) => {
      if (!event.defaultPrevented)
        console.log('Not logged because default is prevented.');
    }}
  >
    <Link onClick={(e) => e.preventDefault()}>Din lenke</Link>
  </Button>
`}
</CodeSnippet>

## Bruk dine egne komponenter

Over har du lært om `asChild`, men kan alle komponentar brukast med `asChild`? I teorien ja, men du må gjere litt arbeid for å få det til å funke. [3]

> Mange av våre komponentar støttar `asChild`, men me har gjort eit valg på korleis element som er standard, og dersom du endrer dette må du passe på at
> tilgjengelegheit er ivaretatt. Det er sjeldent at du behøver å endre det underliggande elementet, men det er meir realistisk at du vil bruke din eigen komponent.

Dersom du skal bruke ein eigen komponent må du passe på å spre alle props, og ha støtte for `ref`. Komponentane dine vil då sjå slik ut:

<CodeSnippet language='ts'>
{`// uten props og ref
  const MinKnapp = () => <button />

// med props
const MinKnapp = (props) => <button {...props} />

// med props og ref
const MinKnapp = React.forwardRef((props, forwardedRef) => (

<button
  {...props}
  ref={forwardedRef}
/>
))`}
</CodeSnippet>

Mange våre komponenter gjer dette allerede, så dersom du skal bruke ein komponent frå oss, så er det berre å bruke `asChild`.

### Referanser

- [1] [Radix Slot](https://www.radix-ui.com/primitives/docs/utilities/slot)
- [2] [Radix Slot Event handlers](https://www.radix-ui.com/primitives/docs/utilities/slot#event-handlers)
- [3] [Radix Composition](https://www.radix-ui.com/primitives/docs/guides/composition)
