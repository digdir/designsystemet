.ds-accordion-group {
  --dsc-accordion-background: var(--ds-color-neutral-background-default);
  --dsc-accordion-border-color: var(--ds-color-neutral-border-subtle);
  --dsc-accordion-border-radius: min(1rem, var(--ds-border-radius-md));
  --dsc-accordion-chevron-background--active: var(--ds-color-neutral-surface-default);
  --dsc-accordion-chevron-background--hover: var(--ds-color-neutral-surface-default);
  --dsc-accordion-chevron-gap: var(--ds-spacing-2);
  --dsc-accordion-chevron-size: var(--ds-spacing-6);
  --dsc-accordion-heading-background--open: var(--ds-color-neutral-background-subtle);
  --dsc-accordion-heading-background: var(--ds-color-neutral-background-default);
  --dsc-accordion-padding: var(--ds-spacing-4);

  &[data-ds-color="subtle"] {
    --dsc-accordion-background: var(--ds-color-neutral-background-subtle);
    --dsc-accordion-border-color: var(--ds-color-neutral-border-default);
    --dsc-accordion-heading-background: var(--ds-color-neutral-background-subtle);
    --dsc-accordion-heading-background--open: var(--ds-color-neutral-surface-default);
    --dsc-accordion-chevron-background--hover: var(--ds-color-neutral-surface-default);
    --dsc-accordion-chevron-background--active: var(--ds-color-neutral-surface-active);
  }

  &[data-ds-color="brand1"] {
    --dsc-accordion-background: var(--ds-color-brand1-background-subtle);
    --dsc-accordion-border-color: var(--ds-color-brand1-border-subtle);
    --dsc-accordion-heading-background: var(--ds-color-brand1-surface-default);
    --dsc-accordion-heading-background--open: var(--ds-color-brand1-surface-hover);
    --dsc-accordion-chevron-background--hover: var(--ds-color-brand1-surface-active);
    --dsc-accordion-chevron-background--active: var(--ds-color-brand1-surface-active);
  }

  &[data-ds-color="brand2"] {
    --dsc-accordion-background: var(--ds-color-brand2-background-subtle);
    --dsc-accordion-border-color: var(--ds-color-brand2-border-subtle);
    --dsc-accordion-heading-background: var(--ds-color-brand2-surface-default);
    --dsc-accordion-heading-background--open: var(--ds-color-brand2-surface-hover);
    --dsc-accordion-chevron-background--hover: var(--ds-color-brand2-surface-active);
    --dsc-accordion-chevron-background--active: var(--ds-color-brand2-surface-active);
  }

  &[data-ds-color="brand3"] {
    --dsc-accordion-background: var(--ds-color-brand3-background-subtle);
    --dsc-accordion-border-color: var(--ds-color-brand3-border-subtle);
    --dsc-accordion-heading-background: var(--ds-color-brand3-surface-default);
    --dsc-accordion-heading-background--open: var(--ds-color-brand3-surface-hover);
    --dsc-accordion-chevron-background--hover: var(--ds-color-brand3-surface-active);
    --dsc-accordion-chevron-background--active: var(--ds-color-brand3-surface-active);
  }
}

.ds-accordion__item {
  background: var(--dsc-accordion-background);
  border-color: var(--dsc-accordion-border-color);
  border-style: solid;
  border-width: 1px 0;

  & > :is(summary, u-summary) {
    background: var(--dsc-accordion-heading-background);
    box-sizing: border-box;
    cursor: pointer;
    list-style: none;
    outline: none;
    padding-block: var(--dsc-accordion-padding);
    padding-inline: calc(var(--dsc-accordion-padding) + var(--dsc-accordion-chevron-size) + var(--dsc-accordion-chevron-gap)) var(--dsc-accordion-padding);

    &:focus-visible {
      box-shadow: var(--dsc-focus-boxShadow); /* Will work when #2313 is merged */
      position: relative; /* Ensure foucs outline renders on top */
    }

    &::before {
      background: currentcolor;
      border-radius: var(--ds-border-radius-md);
      content: '';
      height: var(--dsc-accordion-chevron-size);
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M5.97 9.47a.75.75 0 0 1 1.06 0L12 14.44l4.97-4.97a.75.75 0 1 1 1.06 1.06l-5.5 5.5a.75.75 0 0 1-1.06 0l-5.5-5.5a.75.75 0 0 1 0-1.06'/%3E%3C/svg%3E") 50% / contain no-repeat;
      position: absolute;
      transition: rotate .2s;
      margin-inline: calc((var(--dsc-accordion-chevron-size) + var(--dsc-accordion-chevron-gap)) * -1); /* Using margin instead of top/left to avoid position: relative and to support dir="rtl" */
      width: var(--dsc-accordion-chevron-size);
    }
  }

  & > :not(summary, u-summary) {
    border-radius: inherit;
    padding: var(--ds-spacing-5, 1rem);
  }

  &[open] > :is(summary, u-summary) {
    background: var(--dsc-accordion-heading-background--open);

    &::before { rotate: 180deg }
  }

  &[data-ds-search-prevent]:not([open]) > :not(summary, u-summary) {
    display: none; /* Turn off search-in-page-to-open when state is controlled */
  }
}

.ds-accordion-group > * + * { border-top: 0 }
.ds-accordion-group[data-ds-border] > * { border-width: 1px }

.ds-accordion-group[data-ds-border] > :first-child,
.ds-accordion-group[data-ds-border] > :first-child > :is(summary, u-summary) {
  border-top-left-radius: var(--dsc-accordion-border-radius);
  border-top-right-radius: var(--dsc-accordion-border-radius);
}


.ds-accordion-group[data-ds-border] > :last-child,
.ds-accordion-group[data-ds-border] > :last-child:not([open]) > :is(summary, u-summary) {
  border-bottom-left-radius: var(--dsc-accordion-border-radius);
  border-bottom-right-radius: var(--dsc-accordion-border-radius);
}

@media (hover: hover) and (pointer: fine) {
  .ds-accordion__item > :is(summary, u-summary):hover {
    background: var(--dsc-accordion-chevron-background--hover);
  }

  .ds-accordion__item[open] > :is(summary, u-summary):hover {
    background: var(--dsc-accordion-chevron-background--active);
  }
}
